create database hospital_db;
use hospital_db;

CREATE TABLE patients (
    patient_id INT PRIMARY KEY,
    patient_name VARCHAR(50),
    age INT,
    gender VARCHAR(10),
    city VARCHAR(50)
);

CREATE TABLE doctors (
    doctor_id INT PRIMARY KEY,
    doctor_name VARCHAR(50),
    specialization VARCHAR(50),
    experience_years INT
);

CREATE TABLE appointments (
    appointment_id INT PRIMARY KEY,
    patient_id INT,
    doctor_id INT,
    visit_date DATE,
    diagnosis VARCHAR(100),
    fees DECIMAL(10,2),
    FOREIGN KEY (patient_id) REFERENCES patients(patient_id),
    FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id)
);

INSERT INTO patients VALUES
(1,'Rahul',34,'Male','Hyderabad'),
(2,'Sneha',28,'Female','Bangalore'),
(3,'Arjun',45,'Male','Chennai'),
(4,'Priya',31,'Female','Hyderabad'),
(5,'Kiran',52,'Male','Mumbai'),
(6,'Anjali',40,'Female','Delhi'),
(7,'Vikram',29,'Male','Hyderabad'),
(8,'Meera',36,'Female','Chennai'),
(9,'Rohit',48,'Male','Mumbai'),
(10,'Divya',25,'Female','Bangalore');

INSERT INTO doctors VALUES
(101,'Dr. Sharma','Cardiology',12),
(102,'Dr. Mehta','Neurology',10),
(103,'Dr. Reddy','Orthopedics',8),
(104,'Dr. Kapoor','Dermatology',6),
(105,'Dr. Singh','General Medicine',15);

INSERT INTO appointments VALUES
(1001,1,101,'2025-01-10','Heart Checkup',2000),
(1002,2,102,'2025-01-11','Migraine',1800),
(1003,3,103,'2025-01-15','Fracture',2500),
(1004,4,105,'2025-01-20','Fever',1200),
(1005,5,101,'2025-01-22','Chest Pain',2200),
(1006,6,104,'2025-01-25','Skin Allergy',1500),
(1007,1,105,'2025-02-01','General Checkup',1000),
(1008,7,103,'2025-02-03','Back Pain',2300),
(1009,8,102,'2025-02-05','Headache',1700),
(1010,9,101,'2025-02-10','Heart Follow-up',2100);

show tables from hospital_db;

select * from doctors;
select * from patients;
select * from appointments;

# Basic Joins
# Show patient name, doctor name, visit date, and diagnosis.
select p.patient_name,
		d.doctor_name,
        a.visit_date,
        a.diagnosis
	from patients p
    join appointments a
    on p.patient_id=a.patient_id
    join doctors d 
    on a.doctor_id=d.doctor_id;
    
# Show all doctors and the patients they treated.
select p.patient_name,d.doctor_name
		from patients p
    left join appointments a
    on p.patient_id=a.patient_id
    left join doctors d 
    on a.doctor_id=d.doctor_id;
    
# List all patients and their doctor names.
select p.patient_name,d.doctor_name
		from patients p
    left join appointments a
    on p.patient_id=a.patient_id
    left join doctors d 
    on a.doctor_id=d.doctor_id;
    
# Show appointment details along with patient city.
select a.*,p.city from 
	appointments a 
    left join patients p
    on a.patient_id=p.patient_id;
    
# JOIN + Aggregation
# Count total appointments handled by each doctor.
select d.doctor_name, count(appointment_id) total_appointments
		from doctors d
        join appointments a 
        on d.doctor_id=a.doctor_id
        group by 1;
        
#Calculate total revenue generated by each doctor.
select d.doctor_name, sum(fees) total_revenue
		from doctors d
        left join appointments a 
        on d.doctor_id=a.doctor_id
        group by 1;

#Find total revenue generated city-wise.
select p.city,sum(fees) total_revenue
		from patients p
        left join appointments a 
        on p.patient_id=a.patient_id
        group by 1;

#Find average consultation fee per specialization.
select d.specialization,round(avg(fees),2) average_revenue
		from doctors d
        left join appointments a
        on d.doctor_id=a.doctor_id
        group by 1;
        
#Which doctor handled the highest number of patients?
select d.doctor_name,count(distinct a.doctor_id)Total_count 
	from doctors d 
    left join appointments a
    on d.doctor_id=a.doctor_id
    group by d.doctor_name
    order by total_count desc
    limit 1;
    select * from doctors;
    select * from appointments;
    
#Which specialization earned the highest revenue?
select d.specialization,sum(a.fees)Highest_revenue 
	from doctors d 
    left join appointments a
    on d.doctor_id=a.doctor_id
    group by d.specialization
    order by highest_revenue desc
    limit 1;
    

    

        

